<head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
    <script src="two.js"></script>
</head>
<body></body>
<script>
    let two = new Two({
        fullscreen: true,
        autostart: true
    }).appendTo(document.body);

    
    const playerData = {
        vx: 0,
        vy: 0,
        x: two.width / 2,
        y: two.height / 2,
        playerWidth: 50,
        playerHeight: 50,
        speed: 1
    }

    const gameData = {
        up: 'w',
        down: 's',
        left: 'a',
        right: 'd',
        intervalLength: 20
    }
    
    let rect = two.makeRectangle(two.width / 2, two.height / 2, 50 ,50);
    rect.id = 'player';

    function movePlayer(x, y){
        // deny move if the player is out of the screen
        let outOfBoundsX = false;
        let outOfBoundsY = false;
        if(playerData.x + x < (playerData.playerWidth / 2) || playerData.x + x > two.width - (playerData.playerWidth / 2)){
            outOfBoundsX = true;
        }
        if(playerData.y + y < (playerData.playerHeight / 2) || playerData.y + y > two.height - (playerData.playerHeight / 2)){
            outOfBoundsY = true;
        }

        if(!outOfBoundsX){
            playerData.x += x;
            rect.translation._x += playerData.x;
        }
        
        if(!outOfBoundsY){
            playerData.y += y;
            rect.translation._y += playerData.y;
        }
        

        
        

        // move the player
        rect.translation.set(playerData.x, playerData.y);
    }




    function playerController(){
        const keys = {};
        const friction = 0.9;
        document.onkeydown = e => {
            keys[e.key] = true;
        };

        document.onkeyup = e => {
            keys[e.key] = false;
        };

        function move(){
            if(keys[gameData.up]){
                playerData.vy -= playerData.speed;
                
            }
            if(keys[gameData.down]){
                playerData.vy += playerData.speed;
            }
            if(keys[gameData.left]){
                playerData.vx -= playerData.speed;
            }
            if(keys[gameData.right]){
                playerData.vx += playerData.speed;              
            }

            
            playerData.vx *= friction;
            playerData.vy *= friction;
            
            movePlayer(playerData.vx, playerData.vy);
        }
        setInterval(move, gameData.intervalLength);
    }

    playerController()

    /*
    function playerController(){
        const player = document.getElementById('player');
        const playerRect = player.getBoundingClientRect();
        const areaRect = area.getBoundingClientRect();
        const keys = {};
        const friction = 0.9;
        window.addEventListener('keydown', function(e){
            keys[e.key] = true;
        });
        window.addEventListener('keyup', function(e){
            keys[e.key] = false;
        });
        function movePlayer(){
            if(!gameData.playing) return;
            if(keys[gameData.up]){
                gameData.y -= gameData.speed;
            }
            if(keys[gameData.down]){
                gameData.y += gameData.speed;
            }
            if(keys[gameData.left]){
                gameData.x -= gameData.speed;
            }
            if(keys[gameData.right]){
                gameData.x += gameData.speed;
            }
            
            gameData.x *= friction;
            gameData.y *= friction;
            
            move(gameData.x, gameData.y);
        }
    */


    // npm start
    // electron-packager ./ JS-Game --platform=win32 --arch=ia32 ./JS-Game

</script>